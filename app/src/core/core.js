const _0x191d6f=_0x55cc;(function(_0x55993c,_0x232e44){const _0xdc9926=_0x55cc,_0x1b28de=_0x55993c();while(!![]){try{const _0x67a761=-parseInt(_0xdc9926(0xd6))/0x1+parseInt(_0xdc9926(0x81))/0x2+-parseInt(_0xdc9926(0xa4))/0x3*(-parseInt(_0xdc9926(0xa3))/0x4)+-parseInt(_0xdc9926(0x9b))/0x5*(-parseInt(_0xdc9926(0xb2))/0x6)+-parseInt(_0xdc9926(0xa0))/0x7+-parseInt(_0xdc9926(0xca))/0x8*(parseInt(_0xdc9926(0x91))/0x9)+parseInt(_0xdc9926(0xc4))/0xa*(parseInt(_0xdc9926(0xf1))/0xb);if(_0x67a761===_0x232e44)break;else _0x1b28de['push'](_0x1b28de['shift']());}catch(_0x479c5e){_0x1b28de['push'](_0x1b28de['shift']());}}}(_0x239a,0xbc092));import{ethers}from'ethers';import{Helper}from'../utils/helper.js';function _0x55cc(_0x16f772,_0x92e12b){const _0x239a26=_0x239a();return _0x55cc=function(_0x55ccb0,_0x59b3b0){_0x55ccb0=_0x55ccb0-0x7f;let _0x4db406=_0x239a26[_0x55ccb0];return _0x4db406;},_0x55cc(_0x16f772,_0x92e12b);}import{API}from'./api/api.js';import{GraphQlRequest}from'./graphql/graphql_request.js';import{RPC}from'./network/rpc.js';import _0x38f4ce from'../utils/logger.js';import{Config}from'../../config/config.js';import{HANAFUDA}from'./contract/hanafuda.js';function _0x239a(){const _0x3ebbc6=['sendTransaction','id_token','balance','Tx\x20Executed\x20Waiting\x20For\x20Block\x20Confirmation...','TX\x20DATA\x20','\x20to\x20Hanafuda','executeTx','Balance\x20updated','errors','fetch','Error\x20:\x20','DEPOSITAMOUNT','getGarden','https://hanafuda-backend-app-520478841386.us-central1.run.app','garden','growAction','hash','wallet','data','getUserRequest','acc','Unauthorized','handleError','drawHanafuda','167794MPBdRI','Successfully\x20Draw\x2010x\x20Hanafuda\x20see\x20your\x20collection\x20at\x20https://hanafuda.hana.network/collections','indexOf','Connecting\x20to\x20Account\x20Wallet','getBalance','\x20Points\x20of\x20','syncTx','7890peEOxP','UPDATING\x20TOKEN','getGardenInfo','Please\x20Set\x20Up\x20your\x20wallet\x20Private\x20Key','Syncing\x20TX','tx/','Invalid\x20account\x20Secret\x20Phrase\x20or\x20Private\x20Key','WAITFORBLOCKCONFIRMATION','parseUnits','Private\x20Key','Secret\x20Phrase','interface','CHAINID','estimateGas','Wallet\x20connected..','updateUserData','270SvLCvT','currentMinimizedUser','Successfully\x20Execute\x20Grow\x20Action\x20Got\x20','gwei','executeGrowAction','Try\x20To\x20Deposit\x20','depositETH','status','includes','shortMessage','1230AiaugM','firstOrCreateUserData','insertData','Getting\x20Dashboard\x20Info','syncEthereumTxRequest','2242205VgpQtc','token','getOptimalNonce','15916IzvGBr','117QusvAs','provider','user','...\x20Attempt\x20','totalPoint','/graphql','\x20of\x20','latest','getGardenForCurrentUser','fromPhrase','SYMBOL','tokenUpdate','parseEther','determineType','834PeDdpu','trim','getUserInfo','JsonRpcProvider','RPCURL','getUserStatusRequest','Tx\x20Executed...','info','refreshToken','wait','delay','Executing\x20TX...','deposit','Wallet','pending','address','serializeBigInt','Getting\x20Wallet\x20Balance','2210PtiLDz','GWEIPRICE','POST','stringify','toISOString','refresh_token','351992eRdLYU','encodeFunctionData','message','getTransactionCount','CONTRACT','Successfully\x20deposit\x20to\x20Hanafuda','\x20attempts.','toString','EXPLORER','estimateGasWithRetry','Successfully\x20Sync\x20Deposit\x20TX','currentUser','1153975abbPXN','Drawing\x2010x\x20Hanafuda','connectWallet'];_0x239a=function(){return _0x3ebbc6;};return _0x239a();}import _0x585cb3 from'./db/sqlite.js';import'fs';import{accountLists}from'../../accounts/accounts.js';export default class Core extends API{constructor(_0x557471,_0x5aed7a){const _0x59bd62=_0x55cc;super(_0x59bd62(0xe6),_0x5aed7a),this[_0x59bd62(0xed)]=_0x557471,this[_0x59bd62(0xa5)]=new ethers[(_0x59bd62(0xb5))](RPC[_0x59bd62(0xb6)],RPC[_0x59bd62(0x8d)]);}async[_0x191d6f(0xb4)](_0x1d39f0=![]){const _0x3fa102=_0x191d6f;try{_0x1d39f0&&await Helper[_0x3fa102(0xbc)](0x1f4,this[_0x3fa102(0xed)],'Getting\x20User\x20Info',this);const _0x3fc89c=await this[_0x3fa102(0xe2)](_0x3fa102(0xa9),_0x3fa102(0xc6),this[_0x3fa102(0xed)][_0x3fa102(0xa1)],GraphQlRequest[_0x3fa102(0xec)]);if(_0x3fc89c['status']==0xc8&&!_0x3fc89c[_0x3fa102(0xe1)]){this[_0x3fa102(0xa6)]=_0x3fc89c[_0x3fa102(0xeb)][_0x3fa102(0x92)];const _0x1b5438=await this[_0x3fa102(0xe2)](_0x3fa102(0xa9),_0x3fa102(0xc6),this['acc'][_0x3fa102(0xa1)],GraphQlRequest[_0x3fa102(0xb7)]);if(_0x1b5438[_0x3fa102(0x98)]==0xc8&&!_0x3fc89c[_0x3fa102(0xe1)])this['user']['status']=_0x1b5438['data'][_0x3fa102(0xd5)],_0x1d39f0&&await Helper[_0x3fa102(0xbc)](0x1f4,this[_0x3fa102(0xed)],'Successfully\x20Get\x20User\x20Information',this);else throw _0x1b5438;}else throw _0x3fc89c;}catch(_0x4fdbe9){await this[_0x3fa102(0xef)](_0x4fdbe9);}}async[_0x191d6f(0x83)](_0x43a8af=![]){const _0x438ebf=_0x191d6f;try{_0x43a8af&&await Helper['delay'](0x1f4,this['acc'],_0x438ebf(0x9e),this);const _0x2a3582=await this['fetch'](_0x438ebf(0xa9),'POST',this[_0x438ebf(0xed)][_0x438ebf(0xa1)],GraphQlRequest[_0x438ebf(0xe5)]);if(_0x2a3582['status']==0xc8&&!_0x2a3582[_0x438ebf(0xe1)])this[_0x438ebf(0xe7)]=_0x2a3582[_0x438ebf(0xeb)][_0x438ebf(0xac)],_0x43a8af&&await Helper[_0x438ebf(0xbc)](0x1f4,this[_0x438ebf(0xed)],'Successfully\x20Get\x20Dashboard\x20Information',this);else throw _0x2a3582;}catch(_0xe24b8b){await this['handleError'](_0xe24b8b);}}async['drawHanafuda'](){const _0x5443d5=_0x191d6f;try{await Helper[_0x5443d5(0xbc)](0x1f4,this[_0x5443d5(0xed)],_0x5443d5(0xd7),this);const _0xf47be6=await this['fetch']('/graphql',_0x5443d5(0xc6),this['acc']['token'],GraphQlRequest[_0x5443d5(0xf0)]);if(_0xf47be6['status']==0xc8&&!_0xf47be6[_0x5443d5(0xe1)])await this[_0x5443d5(0x83)](),await Helper['delay'](0xbb8,this[_0x5443d5(0xed)],_0x5443d5(0xf2),this);else throw _0xf47be6;}catch(_0x4f505b){await this['handleError'](_0x4f505b);}}async[_0x191d6f(0xba)](){const _0x588341=_0x191d6f;try{await Helper[_0x588341(0xbc)](0x1f4,this[_0x588341(0xed)],'Getting\x20New\x20Token',this);const _0x3e94b9=await _0x585cb3[_0x588341(0x9c)](this[_0x588341(0xed)]['pk']),_0x3b1f77=await this[_0x588341(0xe2)]('https://securetoken.googleapis.com/v1/token?key=AIzaSyDipzN0VRfTPnMGhQ5PSzO27Cxm3DohJGY',_0x588341(0xc6),undefined,{'grant_type':_0x588341(0xc9),'refresh_token':_0x3e94b9[_0x588341(0xba)]},undefined,!![]);if(_0x3b1f77[_0x588341(0x98)]==0xc8&&!_0x3b1f77[_0x588341(0xe1)])return await Helper['delay'](0x1f4,this[_0x588341(0xed)],'Successfully\x20Get\x20New\x20Token',this),_0x3b1f77;else throw _0x3b1f77;}catch(_0x3285f7){await this[_0x588341(0xef)](_0x3285f7);}}async['startGrowAction'](){const _0x481291=_0x191d6f;try{await Helper[_0x481291(0xbc)](0x1f4,this[_0x481291(0xed)],'Starting\x20Grow\x20Action',this);const _0x39de8e=await this['fetch'](_0x481291(0xa9),_0x481291(0xc6),this['acc'][_0x481291(0xa1)],GraphQlRequest[_0x481291(0xe8)]);if(_0x39de8e[_0x481291(0x98)]==0xc8&&!_0x39de8e[_0x481291(0xe1)])this['user']['status'][_0x481291(0xa8)]=Number(this[_0x481291(0xa6)]['status'][_0x481291(0xa8)])+Number(_0x39de8e[_0x481291(0xeb)][_0x481291(0x95)]),await Helper[_0x481291(0xbc)](0x7d0,this[_0x481291(0xed)],_0x481291(0x93)+_0x39de8e[_0x481291(0xeb)]['executeGrowAction']+_0x481291(0x7f)+this[_0x481291(0xa6)]['status'][_0x481291(0xa8)],this);else throw _0x39de8e;}catch(_0xaa764b){await this[_0x481291(0xef)](_0xaa764b);}}async[_0x191d6f(0x80)](){const _0x4b8de3=_0x191d6f;try{await Helper['delay'](0x1f4,this[_0x4b8de3(0xed)],_0x4b8de3(0x85),this);const _0x4419ad=await this[_0x4b8de3(0xe2)](_0x4b8de3(0xa9),_0x4b8de3(0xc6),this[_0x4b8de3(0xed)][_0x4b8de3(0xa1)],GraphQlRequest[_0x4b8de3(0x9f)](RPC[_0x4b8de3(0x8d)],this[_0x4b8de3(0xe9)]));if(_0x4419ad[_0x4b8de3(0x98)]==0xc8&&!_0x4419ad[_0x4b8de3(0xe1)])await this[_0x4b8de3(0xb4)](),await Helper['delay'](0x1f4,this[_0x4b8de3(0xed)],_0x4b8de3(0xd4),this);else throw _0x4419ad;}catch(_0x323d4f){await this[_0x4b8de3(0xef)](_0x323d4f);}}async[_0x191d6f(0xd8)](){const _0x186d00=_0x191d6f;try{if(!this[_0x186d00(0xed)]['pk'])throw new Error(_0x186d00(0x84));const _0x1f6805=this[_0x186d00(0xed)]['pk'];await Helper[_0x186d00(0xbc)](0x1f4,this['acc'],_0x186d00(0xf4),this);const _0x5593af=Helper[_0x186d00(0xb1)](_0x1f6805);_0x38f4ce[_0x186d00(0xb9)]('Account\x20Type\x20:\x20'+_0x5593af);if(_0x5593af==_0x186d00(0x8b))this[_0x186d00(0xea)]=ethers[_0x186d00(0xbf)][_0x186d00(0xad)](_0x1f6805,this[_0x186d00(0xa5)]);else{if(_0x5593af==_0x186d00(0x8a))this['wallet']=new ethers[(_0x186d00(0xbf))](_0x1f6805[_0x186d00(0xb3)](),this[_0x186d00(0xa5)]);else throw Error(_0x186d00(0x87));}this[_0x186d00(0xc1)]=this[_0x186d00(0xea)][_0x186d00(0xc1)],await Helper['delay'](0x1f4,this[_0x186d00(0xed)],_0x186d00(0x8f),this);}catch(_0x38e4df){await this['handleError'](_0x38e4df);}}async[_0x191d6f(0xf5)](_0x42a244=![]){const _0x5a287f=_0x191d6f;try{!_0x42a244&&await Helper[_0x5a287f(0xbc)](0x1f4,this[_0x5a287f(0xed)],_0x5a287f(0xc3),this);const _0x1a951e=ethers['formatEther'](await this['provider'][_0x5a287f(0xf5)](this['wallet'][_0x5a287f(0xc1)]));this[_0x5a287f(0xdb)]=_0x1a951e,_0x42a244&&await Helper[_0x5a287f(0xbc)](0x1f4,this[_0x5a287f(0xed)],_0x5a287f(0xe0),this);}catch(_0x2a97e3){await this[_0x5a287f(0xef)](_0x2a97e3);}}async[_0x191d6f(0xbe)](){const _0x119276=_0x191d6f;try{await Helper[_0x119276(0xbc)](0x7d0,this[_0x119276(0xed)],_0x119276(0x96)+Config[_0x119276(0xe4)]+'\x20'+RPC[_0x119276(0xae)]+_0x119276(0xde),this);const _0xe247c5=new ethers['Contract'](HANAFUDA[_0x119276(0xce)],HANAFUDA['ABI'],this[_0x119276(0xea)]),_0x596def=ethers[_0x119276(0xb0)](Config[_0x119276(0xe4)][_0x119276(0xd1)]()),_0x1488ec=_0xe247c5[_0x119276(0x8c)][_0x119276(0xcb)](_0x119276(0x97)),_0x33bc0b=await this[_0x119276(0xa2)](),_0x43fde9=await this['estimateGasWithRetry'](HANAFUDA[_0x119276(0xce)],_0x596def,_0x1488ec),_0x1e66b8={'to':HANAFUDA[_0x119276(0xce)],'value':_0x596def,'gasLimit':_0x43fde9,'gasPrice':ethers[_0x119276(0x89)](Config[_0x119276(0xc5)][_0x119276(0xd1)](),_0x119276(0x94)),'nonce':_0x33bc0b,'data':_0x1488ec};await this['executeTx'](_0x1e66b8),await _0x585cb3[_0x119276(0x9d)](this[_0x119276(0xc1)],new Date()[_0x119276(0xc8)]()),this['hash']&&await this[_0x119276(0x80)](),await Helper[_0x119276(0xbc)](0x7d0,this[_0x119276(0xed)],_0x119276(0xcf),this);}catch(_0x15d70c){throw _0x15d70c;}}async['handleError'](_0x1dd67e){const _0x12923c=_0x191d6f;if(_0x1dd67e[_0x12923c(0xe1)]){if(_0x1dd67e[_0x12923c(0xe1)][0x0][_0x12923c(0xcc)][_0x12923c(0x99)]('Unauthorized'))throw Error(_0x12923c(0xee));else await Helper[_0x12923c(0xbc)](0x1388,this[_0x12923c(0xed)],_0x12923c(0xe3)+_0x1dd67e[_0x12923c(0xe1)][0x0]['message'],this);}else throw _0x1dd67e;}async[_0x191d6f(0xdf)](_0x2b0c2b){const _0x27bc61=_0x191d6f;try{_0x38f4ce[_0x27bc61(0xb9)](_0x27bc61(0xdd)+JSON[_0x27bc61(0xc7)](Helper[_0x27bc61(0xc2)](_0x2b0c2b))),await Helper['delay'](0x1f4,this[_0x27bc61(0xed)],_0x27bc61(0xbd),this);const _0x16b51d=await this[_0x27bc61(0xea)][_0x27bc61(0xd9)](_0x2b0c2b);if(Config[_0x27bc61(0x88)]){await Helper[_0x27bc61(0xbc)](0x1f4,this[_0x27bc61(0xed)],_0x27bc61(0xdc),this);const _0x69ff6b=await _0x16b51d[_0x27bc61(0xbb)]();_0x38f4ce[_0x27bc61(0xb9)]('Tx\x20Confirmed\x20and\x20Finalizing:\x20'+JSON[_0x27bc61(0xc7)](_0x69ff6b)),this[_0x27bc61(0xe9)]=_0x69ff6b[_0x27bc61(0xe9)],await Helper[_0x27bc61(0xbc)](0x1388,this[_0x27bc61(0xed)],'Tx\x20Executed\x20\x0a'+RPC[_0x27bc61(0xd2)]+_0x27bc61(0x86)+_0x69ff6b[_0x27bc61(0xe9)],this);}else await Helper[_0x27bc61(0xbc)](0x1f4,this[_0x27bc61(0xed)],_0x27bc61(0xb8),this),await Helper[_0x27bc61(0xbc)](0x1388,this['acc'],'Tx\x20Executed\x20\x0a'+RPC[_0x27bc61(0xd2)]+'tx/'+_0x16b51d[_0x27bc61(0xe9)],this);await this[_0x27bc61(0xf5)](!![]);}catch(_0x5ad265){await this[_0x27bc61(0xef)](_0x5ad265);}}async[_0x191d6f(0xa2)](){const _0x1b3466=_0x191d6f;try{const _0x517eba=await this[_0x1b3466(0xa5)][_0x1b3466(0xcd)](this[_0x1b3466(0xea)][_0x1b3466(0xc1)],_0x1b3466(0xab)),_0x21b8ff=await this[_0x1b3466(0xa5)]['getTransactionCount'](this[_0x1b3466(0xea)]['address'],_0x1b3466(0xc0)),_0x5e2f90=_0x21b8ff>_0x517eba?_0x21b8ff:_0x517eba;return _0x5e2f90;}catch(_0x2e7a1c){await this['handleError'](_0x2e7a1c);}}async[_0x191d6f(0xd3)](_0xc94e74,_0x5bd3af,_0x862649,_0x4d5fc4=0x3,_0x4f1c45=0xbb8){const _0x1bef08=_0x191d6f;for(let _0x3ad7f2=0x0;_0x3ad7f2<_0x4d5fc4;_0x3ad7f2++){try{_0x38f4ce[_0x1bef08(0xb9)]('Estimating\x20Gas\x20for\x20'+_0x862649+'\x20TX');const _0x36b95=await this[_0x1bef08(0xa5)][_0x1bef08(0x8e)]({'from':this[_0x1bef08(0xea)][_0x1bef08(0xc1)],'to':_0xc94e74,'value':_0x5bd3af,'data':_0x862649});return _0x36b95;}catch(_0x57cb1a){await Helper[_0x1bef08(0xbc)](_0x4f1c45,this[_0x1bef08(0xed)],_0x57cb1a[_0x1bef08(0x9a)]+_0x1bef08(0xa7)+(_0x3ad7f2+0x1)+_0x1bef08(0xaa)+_0x4d5fc4,this);if(_0x3ad7f2===_0x4d5fc4-0x1)throw Error('Failed\x20to\x20estimate\x20gas\x20after\x20'+_0x4d5fc4+_0x1bef08(0xd0));}}}async[_0x191d6f(0xaf)](){const _0x5d09d5=_0x191d6f;_0x38f4ce['info'](_0x5d09d5(0x82));const _0x233a1e=accountLists[_0x5d09d5(0xf3)](this[_0x5d09d5(0xed)]),_0xdaf0e4=accountLists[_0x233a1e];if(_0xdaf0e4){const _0x8a63f7=await this['refreshToken']();_0xdaf0e4[_0x5d09d5(0xa1)]=_0x8a63f7[_0x5d09d5(0xda)],_0xdaf0e4[_0x5d09d5(0xba)]=_0x8a63f7[_0x5d09d5(0xc9)],await _0x585cb3[_0x5d09d5(0x90)](_0xdaf0e4['pk'],_0xdaf0e4[_0x5d09d5(0xa1)],_0xdaf0e4[_0x5d09d5(0xba)]);}return _0xdaf0e4;}}