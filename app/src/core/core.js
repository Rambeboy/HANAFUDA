const _0x31cf07=_0x365b;function _0x153e(){const _0x3d1105=['acc','GWEIPRICE','toString','getUserInfo','estimateGasWithRetry','Private\x20Key','Successfully\x20Sync\x20Deposit\x20TX','Successfully\x20Get\x20Dashboard\x20Information','currentMinimizedUser','JsonRpcProvider','firstOrCreateUserData','35421mtudYh','garden','56BMTJDf','includes','Successfully\x20Get\x20User\x20Information','Invalid\x20account\x20Secret\x20Phrase\x20or\x20Private\x20Key','info','totalPoint','updateUserData','parseEther','Wallet','Successfully\x20Get\x20New\x20Token','user','refreshToken','wait','getBalance','Getting\x20User\x20Info','interface','drawHanafuda','tokenUpdate','POST','SYMBOL','TX\x20DATA\x20','1216960LnyXHU','connectWallet','getUserStatusRequest','address','CHAINID','token','\x20Points\x20of\x20','6CyEaMJ','status','Successfully\x20deposit\x20to\x20Hanafuda','getGarden','72589bSLMEY','syncTx','/graphql','parseUnits','executeGrowAction','data','wallet','POLYGON','message','totalValue','\x20of\x20','getOptimalNonce','5553bakQWx','encodeFunctionData','276HYXmBL','formatEther','depositETH','Executing\x20TX...','719761nvRQvT','Getting\x20Dashboard\x20Info','handleError','serializeBigInt','https://hanafuda-backend-app-520478841386.us-central1.run.app','Contract','startGrowAction','\x20attempts.','Unauthorized','delay','1BwepdR','DEPOSITAMOUNT','provider','ABI','indexOf','estimateGas','errors','Drawing\x2010x\x20Hanafuda','Tx\x20Executed\x20\x0a','latest','\x20to\x20Hanafuda','WAITFORBLOCKCONFIRMATION','Wallet\x20connected..','EXPLORER','Try\x20To\x20Deposit\x20','NETWORK','200522gPZkLC','gwei','sendTransaction','stringify','Please\x20Set\x20Up\x20your\x20wallet\x20Private\x20Key','UPDATING\x20TOKEN','trim','Getting\x20New\x20Token','determineType','tx/','Secret\x20Phrase','refresh_token','insertData','getGardenInfo','Successfully\x20Draw\x2010x\x20Hanafuda\x20see\x20your\x20collection\x20at\x20https://hanafuda.hana.network/collections','fetch','syncEthereumTxRequest','executeTx','CONTRACT','Syncing\x20TX','\x20TX','...\x20Attempt\x20','hash','296UShanl','35075eAIhJZ','toISOString','Estimating\x20Gas\x20for\x20'];_0x153e=function(){return _0x3d1105;};return _0x153e();}(function(_0x29310b,_0x4232b0){const _0x4cca41=_0x365b,_0x2effff=_0x29310b();while(!![]){try{const _0x28c1c3=parseInt(_0x4cca41(0x1d4))/0x1*(parseInt(_0x4cca41(0x1e4))/0x2)+parseInt(_0x4cca41(0x196))/0x3*(parseInt(_0x4cca41(0x198))/0x4)+parseInt(_0x4cca41(0x1fc))/0x5+parseInt(_0x4cca41(0x1b4))/0x6*(-parseInt(_0x4cca41(0x1ca))/0x7)+-parseInt(_0x4cca41(0x1fb))/0x8*(parseInt(_0x4cca41(0x1c4))/0x9)+parseInt(_0x4cca41(0x1ad))/0xa+-parseInt(_0x4cca41(0x1b8))/0xb*(parseInt(_0x4cca41(0x1c6))/0xc);if(_0x28c1c3===_0x4232b0)break;else _0x2effff['push'](_0x2effff['shift']());}catch(_0x5c1dde){_0x2effff['push'](_0x2effff['shift']());}}}(_0x153e,0x1c869));import{ethers}from'ethers';import{Helper}from'../utils/helper.js';import{API}from'./api/api.js';import{GraphQlRequest}from'./graphql/graphql_request.js';import{RPC}from'./network/rpc.js';import _0x53e1a3 from'../utils/logger.js';function _0x365b(_0x3661c8,_0x5eb7a1){const _0x153eb3=_0x153e();return _0x365b=function(_0x365b9a,_0x1e67f0){_0x365b9a=_0x365b9a-0x189;let _0x9dae4b=_0x153eb3[_0x365b9a];return _0x9dae4b;},_0x365b(_0x3661c8,_0x5eb7a1);}import{Config}from'../../config/config.js';import{HANAFUDA}from'./contract/hanafuda.js';import _0x1343a5 from'./db/sqlite.js';import'fs';import{accountLists}from'../../accounts/accounts.js';export default class Core extends API{constructor(_0x21cf06,_0x1d7b61){const _0x18918e=_0x365b;super(_0x18918e(0x1ce),_0x1d7b61),this[_0x18918e(0x18b)]=_0x21cf06,this[_0x18918e(0x1d6)]=new ethers[(_0x18918e(0x194))](RPC['RPCURL'],RPC[_0x18918e(0x1b1)]);}async[_0x31cf07(0x18e)](_0x359227=![]){const _0xd2612e=_0x31cf07;try{_0x359227&&await Helper['delay'](0x1f4,this[_0xd2612e(0x18b)],_0xd2612e(0x1a6),this);const _0x3b9f74=await this['fetch']('/graphql',_0xd2612e(0x1aa),this[_0xd2612e(0x18b)]['token'],GraphQlRequest['getUserRequest']);if(_0x3b9f74['status']==0xc8&&!_0x3b9f74[_0xd2612e(0x1da)]){this['user']=_0x3b9f74[_0xd2612e(0x1bd)][_0xd2612e(0x193)];const _0x281f60=await this[_0xd2612e(0x1f3)](_0xd2612e(0x1ba),'POST',this[_0xd2612e(0x18b)][_0xd2612e(0x1b2)],GraphQlRequest[_0xd2612e(0x1af)]);if(_0x281f60[_0xd2612e(0x1b5)]==0xc8&&!_0x3b9f74[_0xd2612e(0x1da)])this['user']['status']=_0x281f60[_0xd2612e(0x1bd)]['currentUser'],_0x359227&&await Helper[_0xd2612e(0x1d3)](0x1f4,this[_0xd2612e(0x18b)],_0xd2612e(0x19a),this);else throw _0x281f60;}else throw _0x3b9f74;}catch(_0x567148){await this[_0xd2612e(0x1cc)](_0x567148);}}async[_0x31cf07(0x1f1)](_0x412468=![]){const _0x19d7a3=_0x31cf07;try{_0x412468&&await Helper[_0x19d7a3(0x1d3)](0x1f4,this[_0x19d7a3(0x18b)],_0x19d7a3(0x1cb),this);const _0x119402=await this[_0x19d7a3(0x1f3)](_0x19d7a3(0x1ba),_0x19d7a3(0x1aa),this[_0x19d7a3(0x18b)]['token'],GraphQlRequest[_0x19d7a3(0x1b7)]);if(_0x119402[_0x19d7a3(0x1b5)]==0xc8&&!_0x119402[_0x19d7a3(0x1da)])this[_0x19d7a3(0x197)]=_0x119402[_0x19d7a3(0x1bd)]['getGardenForCurrentUser'],_0x412468&&await Helper[_0x19d7a3(0x1d3)](0x1f4,this[_0x19d7a3(0x18b)],_0x19d7a3(0x192),this);else throw _0x119402;}catch(_0xffe4a2){await this[_0x19d7a3(0x1cc)](_0xffe4a2);}}async['drawHanafuda'](){const _0x19fdec=_0x31cf07;try{await Helper[_0x19fdec(0x1d3)](0x1f4,this['acc'],_0x19fdec(0x1db),this);const _0x38a8fb=await this[_0x19fdec(0x1f3)](_0x19fdec(0x1ba),'POST',this[_0x19fdec(0x18b)][_0x19fdec(0x1b2)],GraphQlRequest[_0x19fdec(0x1a8)]);if(_0x38a8fb[_0x19fdec(0x1b5)]==0xc8&&!_0x38a8fb['errors'])await this[_0x19fdec(0x1f1)](),await Helper[_0x19fdec(0x1d3)](0xbb8,this[_0x19fdec(0x18b)],_0x19fdec(0x1f2),this);else throw _0x38a8fb;}catch(_0x44a5ee){await this[_0x19fdec(0x1cc)](_0x44a5ee);}}async[_0x31cf07(0x1a3)](){const _0x1db516=_0x31cf07;try{await Helper['delay'](0x1f4,this['acc'],_0x1db516(0x1eb),this);const _0x534c34=await _0x1343a5[_0x1db516(0x195)](this[_0x1db516(0x18b)]['pk']),_0x2b446d=await this[_0x1db516(0x1f3)]('https://securetoken.googleapis.com/v1/token?key=AIzaSyDipzN0VRfTPnMGhQ5PSzO27Cxm3DohJGY',_0x1db516(0x1aa),undefined,{'grant_type':_0x1db516(0x1ef),'refresh_token':_0x534c34['refreshToken']},undefined,!![]);if(_0x2b446d[_0x1db516(0x1b5)]==0xc8&&!_0x2b446d[_0x1db516(0x1da)])return await Helper[_0x1db516(0x1d3)](0x1f4,this['acc'],_0x1db516(0x1a1),this),_0x2b446d;else throw _0x2b446d;}catch(_0x451f89){await this['handleError'](_0x451f89);}}async[_0x31cf07(0x1d0)](){const _0x1e0cad=_0x31cf07;try{await Helper[_0x1e0cad(0x1d3)](0x1f4,this[_0x1e0cad(0x18b)],'Starting\x20Grow\x20Action',this);const _0x5d5cb4=await this[_0x1e0cad(0x1f3)](_0x1e0cad(0x1ba),_0x1e0cad(0x1aa),this[_0x1e0cad(0x18b)]['token'],GraphQlRequest['growAction']);if(_0x5d5cb4['status']==0xc8&&!_0x5d5cb4[_0x1e0cad(0x1da)])this[_0x1e0cad(0x1a2)][_0x1e0cad(0x1b5)]['totalPoint']=Number(this[_0x1e0cad(0x1a2)][_0x1e0cad(0x1b5)][_0x1e0cad(0x19d)])+Number(_0x5d5cb4['data'][_0x1e0cad(0x1bc)][_0x1e0cad(0x1c1)]),await Helper[_0x1e0cad(0x1d3)](0x7d0,this['acc'],'Successfully\x20Execute\x20Grow\x20Action\x20Got\x20'+_0x5d5cb4['data']['executeGrowAction'][_0x1e0cad(0x1c1)]+_0x1e0cad(0x1b3)+this[_0x1e0cad(0x1a2)][_0x1e0cad(0x1b5)][_0x1e0cad(0x19d)],this);else throw _0x5d5cb4;}catch(_0x371522){await this[_0x1e0cad(0x1cc)](_0x371522);}}async[_0x31cf07(0x1b9)](){const _0x26f204=_0x31cf07;try{await Helper[_0x26f204(0x1d3)](0x1f4,this[_0x26f204(0x18b)],_0x26f204(0x1f7),this);const _0x16d773=await this[_0x26f204(0x1f3)](_0x26f204(0x1ba),_0x26f204(0x1aa),this[_0x26f204(0x18b)]['token'],GraphQlRequest[_0x26f204(0x1f4)](RPC[_0x26f204(0x1b1)],this[_0x26f204(0x1fa)]));if(_0x16d773[_0x26f204(0x1b5)]==0xc8&&!_0x16d773[_0x26f204(0x1da)])await this[_0x26f204(0x18e)](),await Helper['delay'](0x1f4,this[_0x26f204(0x18b)],_0x26f204(0x191),this);else throw _0x16d773;}catch(_0x51484e){await this[_0x26f204(0x1cc)](_0x51484e);}}async[_0x31cf07(0x1ae)](){const _0x498390=_0x31cf07;try{if(!this[_0x498390(0x18b)]['pk'])throw new Error(_0x498390(0x1e8));const _0x25381e=this['acc']['pk'];await Helper[_0x498390(0x1d3)](0x1f4,this['acc'],'Connecting\x20to\x20Account\x20Wallet',this);const _0x28cd2d=Helper[_0x498390(0x1ec)](_0x25381e);_0x53e1a3['info']('Account\x20Type\x20:\x20'+_0x28cd2d);if(_0x28cd2d==_0x498390(0x1ee))this['wallet']=ethers[_0x498390(0x1a0)]['fromPhrase'](_0x25381e,this[_0x498390(0x1d6)]);else{if(_0x28cd2d==_0x498390(0x190))this['wallet']=new ethers[(_0x498390(0x1a0))](_0x25381e[_0x498390(0x1ea)](),this['provider']);else throw Error(_0x498390(0x19b));}this[_0x498390(0x1b0)]=this[_0x498390(0x1be)]['address'],await Helper[_0x498390(0x1d3)](0x1f4,this[_0x498390(0x18b)],_0x498390(0x1e0),this);}catch(_0x42a1b8){await this[_0x498390(0x1cc)](_0x42a1b8);}}async[_0x31cf07(0x1a5)](_0x4e16e3=![]){const _0x274f0b=_0x31cf07;try{!_0x4e16e3&&await Helper[_0x274f0b(0x1d3)](0x1f4,this[_0x274f0b(0x18b)],'Getting\x20Wallet\x20Balance',this);const _0x554e79=ethers[_0x274f0b(0x1c7)](await this[_0x274f0b(0x1d6)][_0x274f0b(0x1a5)](this[_0x274f0b(0x1be)]['address']));this['balance']=_0x554e79,_0x4e16e3&&await Helper[_0x274f0b(0x1d3)](0x1f4,this[_0x274f0b(0x18b)],'Balance\x20updated',this);}catch(_0x52548c){await this[_0x274f0b(0x1cc)](_0x52548c);}}async['deposit'](){const _0xd91e0f=_0x31cf07;try{await Helper['delay'](0x7d0,this[_0xd91e0f(0x18b)],_0xd91e0f(0x1e2)+Config[_0xd91e0f(0x1d5)]+'\x20'+RPC[_0xd91e0f(0x1ab)]+_0xd91e0f(0x1de),this);const _0x50bfe6=new ethers[(_0xd91e0f(0x1cf))](HANAFUDA[_0xd91e0f(0x1f6)],HANAFUDA[_0xd91e0f(0x1d7)],this['wallet']),_0x19f7a5=ethers[_0xd91e0f(0x19f)](Config[_0xd91e0f(0x1d5)][_0xd91e0f(0x18d)]()),_0x75d8b4=_0x50bfe6[_0xd91e0f(0x1a7)][_0xd91e0f(0x1c5)](_0xd91e0f(0x1c8)),_0xecec1e=await this[_0xd91e0f(0x1c3)](),_0x33f14e=await this[_0xd91e0f(0x18f)](HANAFUDA['CONTRACT'],_0x19f7a5,_0x75d8b4),_0x7d8d51={'to':HANAFUDA[_0xd91e0f(0x1f6)],'value':_0x19f7a5,'gasLimit':_0x33f14e,'gasPrice':ethers[_0xd91e0f(0x1bb)](Config[_0xd91e0f(0x1e3)]!=_0xd91e0f(0x1bf)?Config[_0xd91e0f(0x18c)]['toString']():(Number(Config[_0xd91e0f(0x18c)])*0x3e8)[_0xd91e0f(0x18d)](),_0xd91e0f(0x1e5)),'nonce':_0xecec1e,'data':_0x75d8b4};await this[_0xd91e0f(0x1f5)](_0x7d8d51),await _0x1343a5[_0xd91e0f(0x1f0)](this['address'],new Date()[_0xd91e0f(0x189)]()),this[_0xd91e0f(0x1fa)]&&await this['syncTx'](),await Helper[_0xd91e0f(0x1d3)](0x7d0,this[_0xd91e0f(0x18b)],_0xd91e0f(0x1b6),this);}catch(_0x35a1cc){throw _0x35a1cc;}}async['handleError'](_0x35effd){const _0x3fbee2=_0x31cf07;if(_0x35effd[_0x3fbee2(0x1da)]){if(_0x35effd[_0x3fbee2(0x1da)][0x0][_0x3fbee2(0x1c0)][_0x3fbee2(0x199)](_0x3fbee2(0x1d2)))throw Error(_0x3fbee2(0x1d2));else await Helper['delay'](0x1388,this['acc'],'Error\x20:\x20'+_0x35effd[_0x3fbee2(0x1da)][0x0][_0x3fbee2(0x1c0)],this);}else throw _0x35effd;}async[_0x31cf07(0x1f5)](_0x4e126d){const _0x223eac=_0x31cf07;try{_0x53e1a3['info'](_0x223eac(0x1ac)+JSON[_0x223eac(0x1e7)](Helper[_0x223eac(0x1cd)](_0x4e126d))),await Helper[_0x223eac(0x1d3)](0x1f4,this[_0x223eac(0x18b)],_0x223eac(0x1c9),this);const _0x4e6845=await this[_0x223eac(0x1be)][_0x223eac(0x1e6)](_0x4e126d);_0x53e1a3[_0x223eac(0x19c)]('Tx\x20Executed\x20\x0a'+RPC['EXPLORER']+_0x223eac(0x1ed)+_0x4e6845[_0x223eac(0x1fa)]);if(Config[_0x223eac(0x1df)]){await Helper[_0x223eac(0x1d3)](0x1f4,this[_0x223eac(0x18b)],'Tx\x20Executed\x20Waiting\x20For\x20Block\x20Confirmation...',this);const _0x953a0b=await _0x4e6845[_0x223eac(0x1a4)]();_0x53e1a3[_0x223eac(0x19c)]('Tx\x20Confirmed\x20and\x20Finalizing:\x20'+JSON[_0x223eac(0x1e7)](_0x953a0b)),this[_0x223eac(0x1fa)]=_0x953a0b[_0x223eac(0x1fa)],await Helper[_0x223eac(0x1d3)](0x1388,this[_0x223eac(0x18b)],_0x223eac(0x1dc)+RPC[_0x223eac(0x1e1)]+'tx/'+_0x953a0b[_0x223eac(0x1fa)],this);}else await Helper[_0x223eac(0x1d3)](0x1f4,this[_0x223eac(0x18b)],'Tx\x20Executed...',this),await Helper[_0x223eac(0x1d3)](0x1388,this[_0x223eac(0x18b)],_0x223eac(0x1dc)+RPC[_0x223eac(0x1e1)]+_0x223eac(0x1ed)+_0x4e6845[_0x223eac(0x1fa)],this);await this[_0x223eac(0x1a5)](!![]);}catch(_0x1691d3){await this[_0x223eac(0x1cc)](_0x1691d3);}}async['getOptimalNonce'](){const _0x56c0d8=_0x31cf07;try{const _0x1b991b=await this['provider']['getTransactionCount'](this['wallet'][_0x56c0d8(0x1b0)],_0x56c0d8(0x1dd)),_0x49075b=await this[_0x56c0d8(0x1d6)]['getTransactionCount'](this['wallet'][_0x56c0d8(0x1b0)],'pending'),_0x51a48f=_0x49075b>_0x1b991b?_0x49075b:_0x1b991b;return _0x51a48f;}catch(_0x3d92ae){await this[_0x56c0d8(0x1cc)](_0x3d92ae);}}async[_0x31cf07(0x18f)](_0x228c23,_0x32b1a5,_0x506843,_0x583b8b=0x3,_0x18da53=0xbb8){const _0x4365f0=_0x31cf07;for(let _0x540c3c=0x0;_0x540c3c<_0x583b8b;_0x540c3c++){try{_0x53e1a3['info'](_0x4365f0(0x18a)+_0x506843+_0x4365f0(0x1f8));const _0x456e80=await this[_0x4365f0(0x1d6)][_0x4365f0(0x1d9)]({'from':this[_0x4365f0(0x1be)][_0x4365f0(0x1b0)],'to':_0x228c23,'value':_0x32b1a5,'data':_0x506843});return _0x456e80;}catch(_0x59ea56){await Helper[_0x4365f0(0x1d3)](_0x18da53,this[_0x4365f0(0x18b)],_0x59ea56['shortMessage']+_0x4365f0(0x1f9)+(_0x540c3c+0x1)+_0x4365f0(0x1c2)+_0x583b8b,this);if(_0x540c3c===_0x583b8b-0x1)throw Error('Failed\x20to\x20estimate\x20gas\x20after\x20'+_0x583b8b+_0x4365f0(0x1d1));}}}async[_0x31cf07(0x1a9)](){const _0x445fac=_0x31cf07;_0x53e1a3[_0x445fac(0x19c)](_0x445fac(0x1e9));const _0x11c8c4=accountLists[_0x445fac(0x1d8)](this[_0x445fac(0x18b)]),_0x42053f=accountLists[_0x11c8c4];if(_0x42053f){const _0x26684a=await this[_0x445fac(0x1a3)]();_0x42053f[_0x445fac(0x1b2)]=_0x26684a['id_token'],_0x42053f['refreshToken']=_0x26684a[_0x445fac(0x1ef)],await _0x1343a5[_0x445fac(0x19e)](_0x42053f['pk'],_0x42053f['token'],_0x42053f[_0x445fac(0x1a3)]);}return _0x42053f;}}