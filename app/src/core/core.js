const _0x40e445=_0x32b7;(function(_0x552ff6,_0x42df15){const _0x4ea14e=_0x32b7,_0x46a919=_0x552ff6();while(!![]){try{const _0x5adeee=-parseInt(_0x4ea14e(0x1c3))/0x1*(parseInt(_0x4ea14e(0x189))/0x2)+parseInt(_0x4ea14e(0x1ac))/0x3+parseInt(_0x4ea14e(0x1b1))/0x4+parseInt(_0x4ea14e(0x193))/0x5+parseInt(_0x4ea14e(0x1d0))/0x6+parseInt(_0x4ea14e(0x18a))/0x7+-parseInt(_0x4ea14e(0x1bf))/0x8;if(_0x5adeee===_0x42df15)break;else _0x46a919['push'](_0x46a919['shift']());}catch(_0x22a97c){_0x46a919['push'](_0x46a919['shift']());}}}(_0x3d4f,0x38ae7));import{ethers}from'ethers';import{Helper}from'../utils/helper.js';import{API}from'./api/api.js';import{GraphQlRequest}from'./graphql/graphql_request.js';import{RPC}from'./network/rpc.js';function _0x3d4f(){const _0x2f6801=['id_token','getOptimalNonce','Successfully\x20Sync\x20Deposit\x20TX','data','currentMinimizedUser','Successfully\x20deposit\x20to\x20Hanafuda','getBalance','DEPOSITAMOUNT','930948MYFZvg','Getting\x20Wallet\x20Balance','wallet','currentUser','totalValue','getUserStatusRequest','Contract','updateUserData','errors','Successfully\x20Get\x20Dashboard\x20Information','provider','getTransactionCount','Successfully\x20Execute\x20Grow\x20Action\x20Got\x20','totalPoint','Connecting\x20to\x20Account\x20Wallet','\x20attempts.','getUserInfo','GWEIPRICE','TX\x20DATA\x20','https://securetoken.googleapis.com/v1/token?key=AIzaSyDipzN0VRfTPnMGhQ5PSzO27Cxm3DohJGY','Getting\x20New\x20Token','syncTx','/graphql','Syncing\x20TX','Wallet','includes','depositETH','Successfully\x20Draw\x2010x\x20Hanafuda\x20see\x20your\x20collection\x20at\x20https://hanafuda.hana.network/collections','gwei','estimateGasWithRetry','info','formatEther','balance','address','parseEther','user','toString','SYMBOL','CONTRACT','ABI','...\x20Attempt\x20','CHAINID','6LVxTxF','2433172ctQYus','POST','Secret\x20Phrase','getGardenForCurrentUser','getUserRequest','stringify','executeGrowAction','acc','fetch','1431995yGeQVq','toISOString','EXPLORER','Tx\x20Executed...','Drawing\x2010x\x20Hanafuda','JsonRpcProvider','startGrowAction','Account\x20Type\x20:\x20','https://hanafuda-backend-app-520478841386.us-central1.run.app','encodeFunctionData','Getting\x20Dashboard\x20Info','garden','sendTransaction','Starting\x20Grow\x20Action','determineType','growAction','getGarden','pending','message','connectWallet','Tx\x20Executed\x20Waiting\x20For\x20Block\x20Confirmation...','shortMessage','Tx\x20Confirmed\x20and\x20Finalizing:\x20','delay','handleError','992139EEOVEU','refreshToken','Successfully\x20Get\x20User\x20Information','trim','Wallet\x20connected..','253228LmRASQ','Private\x20Key','firstOrCreateUserData','fromPhrase','RPCURL','Executing\x20TX...','getGardenInfo','interface','status','syncEthereumTxRequest','Try\x20To\x20Deposit\x20','token','tx/','Invalid\x20account\x20Secret\x20Phrase\x20or\x20Private\x20Key','6414600ZfFYys','executeTx','Successfully\x20Get\x20New\x20Token','Balance\x20updated','49727PXacNx','tokenUpdate','Unauthorized','\x20of\x20','hash'];_0x3d4f=function(){return _0x2f6801;};return _0x3d4f();}import _0x533ac9 from'../utils/logger.js';import{Config}from'../../config/config.js';import{HANAFUDA}from'./contract/hanafuda.js';function _0x32b7(_0x56d671,_0x1d09bd){const _0x3d4fe1=_0x3d4f();return _0x32b7=function(_0x32b786,_0x1dfb34){_0x32b786=_0x32b786-0x172;let _0x1eceb6=_0x3d4fe1[_0x32b786];return _0x1eceb6;},_0x32b7(_0x56d671,_0x1d09bd);}import _0x4ca895 from'./db/sqlite.js';import'fs';import{accountLists}from'../../accounts/accounts.js';export default class Core extends API{constructor(_0x1063e5,_0x535e6d){const _0x4fc52b=_0x32b7;super(_0x4fc52b(0x19b),_0x535e6d),this[_0x4fc52b(0x191)]=_0x1063e5,this[_0x4fc52b(0x1da)]=new ethers[(_0x4fc52b(0x198))](RPC[_0x4fc52b(0x1b5)],RPC[_0x4fc52b(0x188)]);}async[_0x40e445(0x1e0)](_0x281fcd=![]){const _0x1ab890=_0x40e445;try{_0x281fcd&&await Helper[_0x1ab890(0x1aa)](0x1f4,this[_0x1ab890(0x191)],'Getting\x20User\x20Info',this);const _0x428be7=await this[_0x1ab890(0x192)](_0x1ab890(0x175),_0x1ab890(0x18b),this[_0x1ab890(0x191)][_0x1ab890(0x1bc)],GraphQlRequest[_0x1ab890(0x18e)]);if(_0x428be7['status']==0xc8&&!_0x428be7['errors']){this[_0x1ab890(0x182)]=_0x428be7[_0x1ab890(0x1cb)][_0x1ab890(0x1cc)];const _0x1c57ad=await this[_0x1ab890(0x192)]('/graphql','POST',this[_0x1ab890(0x191)][_0x1ab890(0x1bc)],GraphQlRequest[_0x1ab890(0x1d5)]);if(_0x1c57ad[_0x1ab890(0x1b9)]==0xc8&&!_0x428be7[_0x1ab890(0x1d8)])this[_0x1ab890(0x182)]['status']=_0x1c57ad[_0x1ab890(0x1cb)][_0x1ab890(0x1d3)],_0x281fcd&&await Helper[_0x1ab890(0x1aa)](0x1f4,this[_0x1ab890(0x191)],_0x1ab890(0x1ae),this);else throw _0x1c57ad;}else throw _0x428be7;}catch(_0x241548){await this[_0x1ab890(0x1ab)](_0x241548);}}async[_0x40e445(0x1b7)](_0x31f37e=![]){const _0x22162a=_0x40e445;try{_0x31f37e&&await Helper['delay'](0x1f4,this[_0x22162a(0x191)],_0x22162a(0x19d),this);const _0x5be743=await this[_0x22162a(0x192)](_0x22162a(0x175),_0x22162a(0x18b),this[_0x22162a(0x191)][_0x22162a(0x1bc)],GraphQlRequest[_0x22162a(0x1a3)]);if(_0x5be743[_0x22162a(0x1b9)]==0xc8&&!_0x5be743[_0x22162a(0x1d8)])this[_0x22162a(0x19e)]=_0x5be743[_0x22162a(0x1cb)][_0x22162a(0x18d)],_0x31f37e&&await Helper[_0x22162a(0x1aa)](0x1f4,this[_0x22162a(0x191)],_0x22162a(0x1d9),this);else throw _0x5be743;}catch(_0x111df1){await this['handleError'](_0x111df1);}}async['drawHanafuda'](){const _0x29e66b=_0x40e445;try{await Helper['delay'](0x1f4,this[_0x29e66b(0x191)],_0x29e66b(0x197),this);const _0x8b141d=await this[_0x29e66b(0x192)]('/graphql',_0x29e66b(0x18b),this[_0x29e66b(0x191)][_0x29e66b(0x1bc)],GraphQlRequest['drawHanafuda']);if(_0x8b141d['status']==0xc8&&!_0x8b141d[_0x29e66b(0x1d8)])await this['getGardenInfo'](),await Helper['delay'](0xbb8,this['acc'],_0x29e66b(0x17a),this);else throw _0x8b141d;}catch(_0x12adfb){await this['handleError'](_0x12adfb);}}async[_0x40e445(0x1ad)](){const _0xea6684=_0x40e445;try{await Helper['delay'](0x1f4,this[_0xea6684(0x191)],_0xea6684(0x173),this);const _0x5ef8ad=await _0x4ca895[_0xea6684(0x1b3)](this[_0xea6684(0x191)]['pk']),_0x46fdac=await this['fetch'](_0xea6684(0x172),_0xea6684(0x18b),undefined,{'grant_type':'refresh_token','refresh_token':_0x5ef8ad[_0xea6684(0x1ad)]},undefined,!![]);if(_0x46fdac[_0xea6684(0x1b9)]==0xc8&&!_0x46fdac[_0xea6684(0x1d8)])return await Helper[_0xea6684(0x1aa)](0x1f4,this[_0xea6684(0x191)],_0xea6684(0x1c1),this),_0x46fdac;else throw _0x46fdac;}catch(_0x28b382){await this[_0xea6684(0x1ab)](_0x28b382);}}async[_0x40e445(0x199)](){const _0x5c971b=_0x40e445;try{await Helper[_0x5c971b(0x1aa)](0x1f4,this[_0x5c971b(0x191)],_0x5c971b(0x1a0),this);const _0x32977a=await this[_0x5c971b(0x192)]('/graphql',_0x5c971b(0x18b),this[_0x5c971b(0x191)][_0x5c971b(0x1bc)],GraphQlRequest[_0x5c971b(0x1a2)]);if(_0x32977a[_0x5c971b(0x1b9)]==0xc8&&!_0x32977a[_0x5c971b(0x1d8)])this[_0x5c971b(0x182)][_0x5c971b(0x1b9)]['totalPoint']=Number(this[_0x5c971b(0x182)]['status'][_0x5c971b(0x1dd)])+Number(_0x32977a[_0x5c971b(0x1cb)][_0x5c971b(0x190)][_0x5c971b(0x1d4)]),await Helper[_0x5c971b(0x1aa)](0x7d0,this[_0x5c971b(0x191)],_0x5c971b(0x1dc)+_0x32977a['data'][_0x5c971b(0x190)]['totalValue']+'\x20Points\x20of\x20'+this[_0x5c971b(0x182)][_0x5c971b(0x1b9)][_0x5c971b(0x1dd)],this);else throw _0x32977a;}catch(_0x4a1c9d){await this[_0x5c971b(0x1ab)](_0x4a1c9d);}}async[_0x40e445(0x174)](){const _0x10b9da=_0x40e445;try{await Helper[_0x10b9da(0x1aa)](0x1f4,this['acc'],_0x10b9da(0x176),this);const _0x2d5689=await this[_0x10b9da(0x192)](_0x10b9da(0x175),_0x10b9da(0x18b),this[_0x10b9da(0x191)][_0x10b9da(0x1bc)],GraphQlRequest[_0x10b9da(0x1ba)](RPC[_0x10b9da(0x188)],this[_0x10b9da(0x1c7)]));if(_0x2d5689[_0x10b9da(0x1b9)]==0xc8&&!_0x2d5689['errors'])await this['getUserInfo'](),await Helper[_0x10b9da(0x1aa)](0x1f4,this['acc'],_0x10b9da(0x1ca),this);else throw _0x2d5689;}catch(_0x1ac8d6){await this[_0x10b9da(0x1ab)](_0x1ac8d6);}}async[_0x40e445(0x1a6)](){const _0x40dbf7=_0x40e445;try{if(!this[_0x40dbf7(0x191)]['pk'])throw new Error('Please\x20Set\x20Up\x20your\x20wallet\x20Private\x20Key');const _0x968164=this[_0x40dbf7(0x191)]['pk'];await Helper[_0x40dbf7(0x1aa)](0x1f4,this['acc'],_0x40dbf7(0x1de),this);const _0x2a0b0c=Helper[_0x40dbf7(0x1a1)](_0x968164);_0x533ac9[_0x40dbf7(0x17d)](_0x40dbf7(0x19a)+_0x2a0b0c);if(_0x2a0b0c==_0x40dbf7(0x18c))this[_0x40dbf7(0x1d2)]=ethers[_0x40dbf7(0x177)][_0x40dbf7(0x1b4)](_0x968164,this['provider']);else{if(_0x2a0b0c==_0x40dbf7(0x1b2))this[_0x40dbf7(0x1d2)]=new ethers[(_0x40dbf7(0x177))](_0x968164[_0x40dbf7(0x1af)](),this[_0x40dbf7(0x1da)]);else throw Error(_0x40dbf7(0x1be));}this[_0x40dbf7(0x180)]=this['wallet']['address'],await Helper[_0x40dbf7(0x1aa)](0x1f4,this[_0x40dbf7(0x191)],_0x40dbf7(0x1b0),this);}catch(_0x19e804){await this[_0x40dbf7(0x1ab)](_0x19e804);}}async[_0x40e445(0x1ce)](_0x4c1032=![]){const _0x587857=_0x40e445;try{!_0x4c1032&&await Helper[_0x587857(0x1aa)](0x1f4,this[_0x587857(0x191)],_0x587857(0x1d1),this);const _0x27daf7=ethers[_0x587857(0x17e)](await this[_0x587857(0x1da)][_0x587857(0x1ce)](this['wallet'][_0x587857(0x180)]));this[_0x587857(0x17f)]=_0x27daf7,_0x4c1032&&await Helper['delay'](0x1f4,this['acc'],_0x587857(0x1c2),this);}catch(_0x4448b7){await this['handleError'](_0x4448b7);}}async['deposit'](){const _0x4065e1=_0x40e445;try{await Helper['delay'](0x7d0,this[_0x4065e1(0x191)],_0x4065e1(0x1bb)+Config[_0x4065e1(0x1cf)]+'\x20'+RPC[_0x4065e1(0x184)]+'\x20to\x20Hanafuda',this);const _0x14e94e=new ethers[(_0x4065e1(0x1d6))](HANAFUDA[_0x4065e1(0x185)],HANAFUDA[_0x4065e1(0x186)],this[_0x4065e1(0x1d2)]),_0x14a8fc=ethers[_0x4065e1(0x181)](Config[_0x4065e1(0x1cf)][_0x4065e1(0x183)]()),_0x193dc4=_0x14e94e[_0x4065e1(0x1b8)][_0x4065e1(0x19c)](_0x4065e1(0x179)),_0x3eef79=await this[_0x4065e1(0x1c9)](),_0x2aa7b3=await this[_0x4065e1(0x17c)](HANAFUDA['CONTRACT'],_0x14a8fc,_0x193dc4),_0x4a83bc={'to':HANAFUDA[_0x4065e1(0x185)],'value':_0x14a8fc,'gasLimit':_0x2aa7b3,'gasPrice':ethers['parseUnits'](Config[_0x4065e1(0x1e1)][_0x4065e1(0x183)](),_0x4065e1(0x17b)),'nonce':_0x3eef79,'data':_0x193dc4};await this[_0x4065e1(0x1c0)](_0x4a83bc),await _0x4ca895['insertData'](this[_0x4065e1(0x180)],new Date()[_0x4065e1(0x194)]()),this[_0x4065e1(0x1c7)]&&await this[_0x4065e1(0x174)](),await Helper[_0x4065e1(0x1aa)](0x7d0,this[_0x4065e1(0x191)],_0x4065e1(0x1cd),this);}catch(_0x4bcb21){throw _0x4bcb21;}}async['handleError'](_0x1c2cc9){const _0x3ca1ec=_0x40e445;if(_0x1c2cc9[_0x3ca1ec(0x1d8)]){if(_0x1c2cc9['errors'][0x0][_0x3ca1ec(0x1a5)][_0x3ca1ec(0x178)](_0x3ca1ec(0x1c5)))throw Error(_0x3ca1ec(0x1c5));else await Helper[_0x3ca1ec(0x1aa)](0x1388,this['acc'],'Error\x20:\x20'+_0x1c2cc9[_0x3ca1ec(0x1d8)][0x0][_0x3ca1ec(0x1a5)],this);}else throw _0x1c2cc9;}async[_0x40e445(0x1c0)](_0x23b16c){const _0x28fcdb=_0x40e445;try{_0x533ac9[_0x28fcdb(0x17d)](_0x28fcdb(0x1e2)+JSON[_0x28fcdb(0x18f)](Helper['serializeBigInt'](_0x23b16c))),await Helper['delay'](0x1f4,this[_0x28fcdb(0x191)],_0x28fcdb(0x1b6),this);const _0x416ca4=await this[_0x28fcdb(0x1d2)][_0x28fcdb(0x19f)](_0x23b16c);if(Config['WAITFORBLOCKCONFIRMATION']){await Helper[_0x28fcdb(0x1aa)](0x1f4,this[_0x28fcdb(0x191)],_0x28fcdb(0x1a7),this);const _0x4be4d5=await _0x416ca4['wait']();_0x533ac9[_0x28fcdb(0x17d)](_0x28fcdb(0x1a9)+JSON[_0x28fcdb(0x18f)](_0x4be4d5)),this[_0x28fcdb(0x1c7)]=_0x4be4d5[_0x28fcdb(0x1c7)],await Helper['delay'](0x1388,this[_0x28fcdb(0x191)],'Tx\x20Executed\x20\x0a'+RPC[_0x28fcdb(0x195)]+_0x28fcdb(0x1bd)+_0x4be4d5[_0x28fcdb(0x1c7)],this);}else await Helper['delay'](0x1f4,this[_0x28fcdb(0x191)],_0x28fcdb(0x196),this),await Helper[_0x28fcdb(0x1aa)](0x1388,this[_0x28fcdb(0x191)],'Tx\x20Executed\x20\x0a'+RPC[_0x28fcdb(0x195)]+_0x28fcdb(0x1bd)+_0x416ca4[_0x28fcdb(0x1c7)],this);await this['getBalance'](!![]);}catch(_0x5e1f92){await this['handleError'](_0x5e1f92);}}async[_0x40e445(0x1c9)](){const _0x4f0437=_0x40e445;try{const _0x2eb1c4=await this[_0x4f0437(0x1da)][_0x4f0437(0x1db)](this['wallet'][_0x4f0437(0x180)],'latest'),_0x4d7304=await this[_0x4f0437(0x1da)][_0x4f0437(0x1db)](this['wallet'][_0x4f0437(0x180)],_0x4f0437(0x1a4)),_0x44bed4=_0x4d7304>_0x2eb1c4?_0x4d7304:_0x2eb1c4;return _0x44bed4;}catch(_0x411119){await this[_0x4f0437(0x1ab)](_0x411119);}}async[_0x40e445(0x17c)](_0x296008,_0x43fa9c,_0x29d6f1,_0xb6757c=0x3,_0x5302c2=0xbb8){const _0x1faa04=_0x40e445;for(let _0xa89bd3=0x0;_0xa89bd3<_0xb6757c;_0xa89bd3++){try{_0x533ac9[_0x1faa04(0x17d)]('Estimating\x20Gas\x20for\x20'+_0x29d6f1+'\x20TX');const _0x39a955=await this['provider']['estimateGas']({'from':this[_0x1faa04(0x1d2)][_0x1faa04(0x180)],'to':_0x296008,'value':_0x43fa9c,'data':_0x29d6f1});return _0x39a955;}catch(_0x3f8087){await Helper['delay'](_0x5302c2,this[_0x1faa04(0x191)],_0x3f8087[_0x1faa04(0x1a8)]+_0x1faa04(0x187)+(_0xa89bd3+0x1)+_0x1faa04(0x1c6)+_0xb6757c,this);if(_0xa89bd3===_0xb6757c-0x1)throw Error('Failed\x20to\x20estimate\x20gas\x20after\x20'+_0xb6757c+_0x1faa04(0x1df));}}}async[_0x40e445(0x1c4)](){const _0x16edd3=_0x40e445;_0x533ac9[_0x16edd3(0x17d)]('UPDATING\x20TOKEN');const _0x261e7a=accountLists['indexOf'](this[_0x16edd3(0x191)]),_0x3529da=accountLists[_0x261e7a];if(_0x3529da){const _0x4181d4=await this[_0x16edd3(0x1ad)]();_0x3529da[_0x16edd3(0x1bc)]=_0x4181d4[_0x16edd3(0x1c8)],_0x3529da[_0x16edd3(0x1ad)]=_0x4181d4['refresh_token'],await _0x4ca895[_0x16edd3(0x1d7)](_0x3529da['pk'],_0x3529da[_0x16edd3(0x1bc)],_0x3529da[_0x16edd3(0x1ad)]);}return _0x3529da;}}